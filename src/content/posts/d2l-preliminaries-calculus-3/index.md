---
title: "什么是梯度？"
description: "上上篇笔记中提到梯度的定义。不过，仅凭定义，我们仍不能很好地看出梯度如何刻画标量函数变化的整体趋势。我们希望得到一个解释：梯度到底是什么？"
published: 2026-02-07
# updated: 2026-02-07
tags: [机器学习, 深度学习, 数学, 微分]
category: 笔记
series: "动手学深度学习"
draft: false
---

:::important[免责声明]
- 这是对上上篇笔记『[机器学习中的微分](/posts/d2l-preliminaries-calculus-1/)』内容的补充. 
- 文中包含一些个人理解. 惟笔记作者水平有限，**内容难免有疏漏、模糊、不严谨之处**. 
- 文中关于导数和梯度的符号写法可能是不规范的，但愿至少没有歧义. 
:::

回顾一下，我们将多元标量函数 $f(x_1,x_2,\ldots,x_n)$ 的梯度定义为**列向量**

$$
\nabla f(x_1,x_2,\ldots,x_n) = \left(\frac{\partial f}{\partial x_1}, \frac{\partial f}{\partial x_2}, \cdots,\frac{\partial f}{\partial x_n}\right)^\top.
$$

在上上篇笔记中，我们这样引出这个定义：

> 我们希望刻画标量 $f(\mathbf{x})$ 关于向量 $\mathbf{x}$ 各个分量变化的一个**整体趋势**，因此我们计算标量对向量每个分量的偏导数，再将这些偏导数按对应向量分量的顺序写成一个新的向量. 

但仅从定义，我们仍不能很好地看出梯度如何刻画多元函数关于自变量变化的整体趋势——将各个偏导写成向量，这样就可以了吗？梯度到底包含了怎样的信息呢？

---

## 基础设定

我们从二元函数开始考虑. 

设有二元函数 $z=f(x,y)$，其定义域为 $\R ^2$，且在任意一点处都具有偏导数. 

可以画出一个三维曲面 $\{(x,y,z)∣z=f(x,y)\}$ 来表示这个函数. 

函数的自变量 $(x,y)$ 取值于 $xOy$ 平面，对应的函数值 $f(x,y)$ 则作为高度 $z$，从而得到曲面上的一个点. 接下来，我们以在定义域平面上移动点 $(x,y)$ 时，曲面上对应点的高度的变化来理解函数的变化趋势. 

## 偏导数

我们首先回到只关心函数**局部**变化趋势的偏导数. 偏导数表示一个多元函数在一点处，当其中一个自变量发生偏移，而其它自变量保持不变时，函数值的变化趋势. 

例如考虑 $z=f(x,y)$ 在点 $(x_0,y_0,z_0)$ 关于 $y$ 的偏导数. 

我们先取定 $x=x_0$，这相当于选取一个平行于平面 $yOz$ 的平面. 

该平面与曲面 $z=f(x,y)$ 相交，截得一条曲线：$\begin{cases} z = f(x,y), \\ x = x_0. \end{cases}$

在平面内，这条空间曲线可以视作一条平面曲线 $z=f(x_0,y)$. 

因此，在保持 $x$ 不变时，自变量 $y$ 的变化使二元函数在该截面内退化为一元函数. 我们由此按照一元函数的方式定义偏导数：

$$
\frac{\partial f}{\partial y}\bigg|_{x=x_0,y=y_0} = \lim_{\Delta y\to0} \frac{f(x_0,y_0+\Delta y)-f(x_0,y_0)}{\Delta y}.
$$

这样，$z$ 对 $y$ 的偏导数描述的就是在平面 $x=x_0$ 内，截得的曲线在该点的切线斜率. 

然而，在求偏导数的过程中，我们的做法是给某个坐标取定值，所以所选取的截面始终与坐标平面平行，自变量**仅沿其中一个坐标轴的方向**偏移. 

但当自变量于定义域平面内取值时，在一点 $(x_0,y_0)$ 处可以沿平面内任意方向发生偏移. 于是可以进一步提出问题：**我们能不能选取一个取向任意，但始终垂直于面 $xOy$ 的平面去截曲面，并研究当自变量沿对应方向偏移时，函数的变化趋势？**

## 方向导数

我们可以引入方向导数来回答上面的问题. 

在定义域平面上取定一个**单位**向量 $\mathbf u=(u_1,u_2)$作为方向向量. 它在我们表示曲面的空间中对应一个平行于面 $xOy$ 的向量 $\mathbf u' = (u_1,u_2,0)$. 

考虑平面上的参数方程 $(x,y)=(x_0,y_0)+t\mathbf u$，也即

$$
\begin{cases} x = x_0 + tu_1, \\ y = y_0 + tu_2. \end{cases}
$$

它限制点 $(x,y)$ 从 $(x_0,y_0)$ 沿方向 $\mathbf u$ 运动，由此确定了一条平面直线. 

将方程 $\begin{cases} x = x_0 + tu_1 \\ y = y_0 + tu_2 \end{cases}$ 放到空间中，我们确定了一个由方向 $\mathbf u'$ 与 $z$ 轴张成的平面，即一个沿方向 $\mathbf u'$，垂直于面 $xOy$ 的平面. 

将这个平面与曲面 $z=f(x,y)$ 联立，得到关于 $t$ 的一元函数

$$
z=\varphi(t)=f(x_0+tu_1,y_0+tu_2).
$$

几何上，这等价于用由方向 $\mathbf u'$ 与 $z$ 轴张成的竖直平面截曲面 $z=f(x,y)$，截得的曲线即为该一元函数的图像. 

函数在点 $(x_0,y_0)$ 沿方向 $\mathbf u$ 的**方向导数**，定义为该截面曲线在 $t=0$ 处的导数：

$$
\frac{\partial f}{\partial \mathbf u}\bigg|_{x=x_0,y=y_0} = \frac{\mathrm d \varphi}{\mathrm d t}\bigg|_{t=0} = \lim_{t\to0} \frac{f(x_0+tu_1, y_0+tu_2) - f(x_0, y_0)}{t}.
$$

因此，方向导数的意义是：**在指定平面方向下，二元函数通过截面退化为一元函数，其在该点的变化率. **

:::tip[提示]
这里的记法 $\frac{\partial}{\partial \mathbf u}$ 并不表示对向量求导，仅表示沿自变量平面上的 $\mathbf u$ 方向求导. 因为 $\mathbf u$ 并不是 $f(x,y)$ 的自变量，而是自变量的「取值方向」. 
:::

## 梯度的性质

前一节中，方向导数依赖于所选方向 $\mathbf u$. 我们已经能用方向导数来刻画二元函数在**任意单一方向**上的变化趋势. 那么，如何刻画函数在一点处对**所有方向**的变化趋势，也就是一个「**整体趋势**」呢？

按照我们已经给出的定义，函数在 $(x_0,y_0)$ 处的**梯度**为

$$
\nabla f(x,y)\big|_{x=x_0,y=y_0} = \left(\frac{\partial f}{\partial x}\bigg|_{x=x_0,y=y_0},\frac{\partial f}{\partial y}\bigg|_{x=x_0,y=y_0}\right)^\top.
$$

先前的一元函数 $\varphi(t)=f(x_0+tu_1,y_0+tu_2)$ 可以视作一个两层的复合函数，外层是 $f=(v_x(t),v_y(t))$，内层是 $v_x(t)=x_0+tu_1$ 和 $v_y(t)=y_0+tu_2$. 

我们观察用[链式法则](/posts/d2l-preliminaries-calculus-1/#链式法则)将 $\varphi (t)$ 关于 $t$ 求导的结果：

$$
\begin{aligned}
    \frac{\mathrm d \varphi}{\mathrm d t} &= \frac{\partial f}{\partial v_x} \cdot \frac{\partial v_x}{\partial t} + \frac{\partial f}{\partial v_y} \cdot \frac{\partial v_y}{\partial t} \\
    &= \frac{\partial f}{\partial v_x} \cdot u_1 + \frac{\partial f}{\partial v_y} \cdot u_2 \\
    &= \nabla f(v_x,v_y) \cdot \mathbf u.
\end{aligned}
$$

那么函数在点 $(x_0,y_0)$ 沿方向 $\mathbf u$ 的方向导数

$$
\frac{\partial f}{\partial \mathbf u}\bigg|_{x=x_0,y=y_0} = \frac{\mathrm d \varphi}{\mathrm d t}\bigg|_{t=0} = \nabla f(x,y)\big|_{x=x_0,y=y_0}\cdot\mathbf u.
$$

这表明，梯度是一个平面向量，它通过与**单位**方向向量 $\mathbf u$ 的内积，给出点 $(x_0,y_0)$ 在任意方向上的方向导数. 换句话说，**梯度在 $\mathbf u$ 方向上的分量就是该方向上的方向导数**，即

$$
\boxed{\frac{df}{d\mathbf u} = |\nabla f| \cos\theta},
$$

其中 $\theta$ 为方向 $\mathbf u$ 与梯度 $\nabla f$ 的夹角. 

由此得到：

- 当 $\mathbf u$ 与 $\nabla f$ 同向时，方向导数取最大值 $|\nabla f|$；
- 当 $\mathbf u$ 与 $\nabla f$ 正交时，方向导数为 0；
- 当 $\mathbf u$ 与 $\nabla f$ 反向时，方向导数取最小值 $-|\nabla f|$. 

## 梯度的意义

根据梯度的上述性质，可知：

1. 自变量在定义域平面上沿梯度方向发生微小变化时，方向导数取得最大值，即函数值上升最快；沿梯度的反方向发生微小变化时，方向导数取得最小值，即函数值下降最快. 

2. 在值域上取一函数值 $z_0$，可以找到若干自变量 $(x,y)$，使得它们都满足 $z_0=(x,y)$. 这些 $(x,y)$ 构成的集合 $\{(x,y)|z_0=(x,y)\}$ 表示在定义域平面上， $z=z_0$ 的「等高线」. 那么，等高线上任意一点的切线方向会与这一点的梯度方向垂直. 
   
:::note[说明]
自变量沿一条等高线变化时，函数值保持不变. 按照方向导数的意义，沿等高线上任意一点切线方向的方向导数应该为 0. 又根据方向导数与 $\nabla f$ 的关系，可知梯度的方向应该与切线方向正交. 
:::

3. 考虑到在多元标量函数的定义域变为 $\R ^n \; (n>2)$ 或其特定子集时，仍然可以以同样的形式定义单位方向向量和方向导数，并推出关系 $\frac{df}{d\mathbf u} = |\nabla f| \cos\theta$，所以以上两点意义仍然成立（虽然这变得有点难以直观想象）. 